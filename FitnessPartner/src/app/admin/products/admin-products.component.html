<div class="admin-header">
  <h2>Products Management</h2>
  <button (click)="addNewProduct()" >Add New Product</button>
</div>

<div class="product-card" *ngFor="let product of products">
  <div class="product-header">
    <img [src]="product.image" alt="{{ product.name }}" (click)="navigateToProduct(product.id)" />
    <div class="product-info">
      <h3 (click)="navigateToProduct(product.id)" class="text-decoration-underline">{{ product.name }}</h3>
      <p><strong>ID:</strong> {{ product.id }}</p>
      <p><strong>Price:</strong> {{ product.price | currency }}</p>
      <p><strong>Brand:</strong> {{ product.brand }}</p>
      <p><strong>Stock:</strong> {{ product.inStock ? 'In Stock' : 'Out of Stock' }}</p>
    </div>
    <div class="product-actions" (click)="$event.stopPropagation()">
      <button class="edit-btn btn btn-outline-light orange-btn" (click)="openEditProductModal(product)">Edit</button>
      <i class="bi bi-trash trashIcon border-0 fs-4 ms-4" (click)="deleteProduct(product.id.toString())"></i>
    </div>
  </div>

  <div class="flavors">
    <h4>Flavors:</h4>
    <div class="flavor-card" *ngFor="let flavor of getFlavors(product)">
      <img [src]="product.product_images[flavor]" [alt]="flavor" />
      <div class="flavor-info">
        <p><strong>{{ flavor }}</strong></p>
        <p>Quantity: {{ product.flavor_quantity[flavor] }}</p>
        <button (click)="editFlavor(product.id, flavor)">Edit</button>
        <i class="bi bi-trash trashIcon border-0 fs-5 ms-2" (click)="deleteFlavor(product.id.toString(), flavor)"></i>
      </div>
    </div>
  </div>
</div>

<!-- Flavor Modal -->
<div class="modal" *ngIf="showFlavorModal">
  <div class="modal-content">
    <h3>Edit Quantity for {{ currentFlavor }}</h3>
    <input type="number" [(ngModel)]="currentQuantity" min="0" />
    <div class="modal-buttons">
      <button (click)="saveFlavorQuantity()">Save</button>
      <button (click)="closeFlavorModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Product Edit Modal -->
<div class="modal" *ngIf="showProductModal">
  <div class="modal-content">
    <h3>Edit Product</h3>
    <label>Price:</label>
    <input type="number" [(ngModel)]="editingProduct!.price" min="0" />

    <label>Image URL:</label>
    <input type="text" [(ngModel)]="editingProduct!.image" />

    <h4>Add New Flavor</h4>
    <input type="text" placeholder="Flavor Name" [(ngModel)]="newFlavorName" />
    <input type="number" placeholder="Flavor Quantity" [(ngModel)]="newFlavorQuantity" min="0" />
    <input type="text" placeholder="Flavor Image URL" [(ngModel)]="newFlavorImage" />
    <button (click)="addFlavorToProduct()">Add Flavor</button>

    <div class="modal-buttons">
      <button (click)="saveProductChanges()">Save</button>
      <button (click)="closeProductModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Add Product Form -->
<div *ngIf="showAddProductForm" class="">
  <div class="">
    <h3 (click)="addNewProduct()">Add New Product</h3>
    <label class="">Product Name:</label>
    <input type="text" [(ngModel)]="newProduct.name" />
    <label>Price:</label>
    <input type="number" [(ngModel)]="newProduct.price" min="0" />

    <label>Image URL:</label>
    <input type="text" [(ngModel)]="newProduct.image" />

    <label>Brand:</label>
    <input type="text" [(ngModel)]="newProduct.brand" />

    <label>Description:</label>
    <input type="text" [(ngModel)]="newProduct.description" />

    <label>Expiration Date:</label>
    <input type="date" [(ngModel)]="newProduct.expiration_date" />

    <label>Available Size:</label>
    <input type="text" [(ngModel)]="newProduct.available_size" />

    <label>Category:</label>
    <input type="text" [(ngModel)]="newProduct.category" />

    <label>Stock Quantity:</label>
    <input type="number" [(ngModel)]="newProduct.quantity" min="0" />

    <button (click)="addNewProduct()">Add Product</button>
    <button (click)="toggleAddProductForm()">Cancel</button>
  </div>
</div>
